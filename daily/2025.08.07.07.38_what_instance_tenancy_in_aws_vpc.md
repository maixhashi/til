# AWS VPCのinstance_tenancy設定とは

## What's this file?
> [!NOTE]
> **What**
> 
> AWS VPCにおけるinstance_tenancy設定とは何かについて記載しています。

## Conclusion (忙しいとき向け)
> [!IMPORTANT]
> **What** : instance_tenancyとは何か
> 
> **Answer** : VPC内で起動するEC2インスタンスのハードウェア配置戦略を決定する設定で、共有ハードウェア（default）、専用ハードウェア（dedicated）、専用ホスト（host）から選択する

## 目次

<details>
<summary>目次を開く</summary>

- [instance_tenancyの概要](#instance_tenancyの概要)
- [3つの設定値の違い](#3つの設定値の違い)
- [default設定の特徴](#default設定の特徴)
- [dedicated設定の特徴](#dedicated設定の特徴)
- [host設定の特徴](#host設定の特徴)
- [設定値の選択基準](#設定値の選択基準)
- [コストへの影響](#コストへの影響)
- [プロジェクトでの設定理由](#プロジェクトでの設定理由)

</details>

## instance_tenancyの概要

`instance_tenancy`は、AWS VPC内で起動するEC2インスタンスの物理的なハードウェア配置を制御する設定です。

主な役割：
- EC2インスタンスの物理サーバー配置の決定
- セキュリティとコンプライアンス要件への対応
- コストとパフォーマンスのバランス調整

## 3つの設定値の違い

### 設定可能な値

| 設定値 | 説明 | 用途 |
|-------|------|------|
| default | 共有ハードウェア上で実行 | 一般的な用途 |
| dedicated | 専用ハードウェア上で実行 | 高セキュリティ要件 |
| host | 専用物理ホスト上で実行 | ライセンス要件対応 |

## default設定の特徴

### メリット
- **コスト効率**：最も安価な選択肢
- **柔軟性**：インスタンスタイプの変更が容易
- **可用性**：AWSの大規模なリソースプールを活用

### デメリット
- 他の顧客とハードウェアを共有
- 特定のコンプライアンス要件を満たせない場合がある

### 適用例
```hcl
instance_tenancy = "default"
```

## dedicated設定の特徴

### メリット
- **物理的分離**：他の顧客から完全に分離
- **コンプライアンス**：規制要件への対応
- **予測可能なパフォーマンス**：リソース競合なし

### デメリット
- 追加コスト（約10%の料金増加）
- 一部のインスタンスタイプで利用不可
- リソースの効率的な利用が困難

### 適用例
```hcl
instance_tenancy = "dedicated"
```

## host設定の特徴

### メリット
- **ライセンス対応**：BYOL（Bring Your Own License）に対応
- **最大の制御**：物理ホストレベルでの管理
- **アフィニティ設定**：特定のホストへの配置指定

### デメリット
- 最も高コスト
- 管理の複雑性増加
- 柔軟性の低下

### 適用例
```hcl
instance_tenancy = "host"
```

## 設定値の選択基準

### default を選ぶべき場合

1. **一般的なWebアプリケーション**
   - コスト最適化が重要
   - 特別なセキュリティ要件なし

2. **開発・テスト環境**
   - 柔軟性が必要
   - コスト削減優先

3. **スタートアップ段階**
   - リソースの効率的利用
   - 迅速なスケーリング

### dedicated を選ぶべき場合

1. **規制要件**
   - 金融・医療業界のコンプライアンス
   - データの物理的分離が必須

2. **高セキュリティ環境**
   - 機密データの処理
   - 他テナントからの完全分離

### host を選ぶべき場合

1. **ライセンス要件**
   - Windows ServerやSQL Serverのライセンス
   - ソケット/コア単位のライセンス

2. **特殊な管理要件**
   - ホストレベルでの監視
   - 特定のハードウェア構成

## コストへの影響

### 料金比較（概算）

| 設定値 | 追加コスト | 例（t3.medium） |
|-------|------------|----------------|
| default | なし | $0.0416/時間 |
| dedicated | +10% | $0.0458/時間 |
| host | 専用ホスト料金 | $2.00+/時間 |

### コスト最適化のポイント

- 本番環境でも`default`で十分な場合が多い
- `dedicated`は真に必要な場合のみ使用
- `host`はライセンスコストとの比較で判断

## プロジェクトでの設定理由

一般的なプロジェクトで`default`を選択している理由：

1. **コスト効率**
   - 標準的なWebアプリケーション
   - 追加コストの正当化困難

2. **柔軟性の確保**
   - インスタンスタイプの変更容易
   - スケーリング対応

3. **要件の適合**
   - 特別なコンプライアンス要件なし
   - 一般的なセキュリティ要件で十分

```hcl
resource "aws_vpc" "example_project" {
  instance_tenancy = "default"  # 標準的な共有テナンシー
  # 他の設定...
}
```

## 関連

- [AWS EC2 Dedicated Instances](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/dedicated-instance.html)
- [AWS EC2 Dedicated Hosts](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/dedicated-hosts-overview.html)
- VPCセキュリティのベストプラクティス
- クラウドコスト最適化ガイド