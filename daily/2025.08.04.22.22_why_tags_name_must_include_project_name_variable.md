# なぜTerraformのタグ名に${var.project_name}を含める必要があるのか

## What's this file?
> [!NOTE]
> **Why**
> 
> **なぜ**Terraformのタグ引数のName値に`${var.project_name}`を含める必要があるのか

## Conclusion (忙しいとき向け)
> [!IMPORTANT]
> **Why** : **なぜ**タグのName値に`${var.project_name}`を含める必要があるのか
> 
> **Answer** : AWSアカウント内でリソースを一意に識別し、複数プロジェクトが共存する環境での名前衝突を防ぐため

## 目次
<details>
<summary>目次を開く</summary>

- [リソース識別の必要性](#リソース識別の必要性)
- [名前衝突の回避](#名前衝突の回避)
- [運用管理の効率化](#運用管理の効率化)
- [ベストプラクティス](#ベストプラクティス)

</details>

## リソース識別の必要性

AWSコンソールやCLIでリソースを検索・管理する際、タグのName値が重要な識別子となります。

```hcl
tags = {
  Name = "${var.project_name}-server-Public-A-${var.environment}"
}
```

このように記述することで、以下の情報が一目で分かります：
- プロジェクト名（例：example-project）
- リソースの用途（例：server）
- サブネットのタイプ（例：Public）
- アベイラビリティゾーン（例：A）
- 環境（例：dev, stg, prod）

## 名前衝突の回避

同一AWSアカウント内で複数のプロジェクトが稼働する場合、プロジェクト名を含めないと名前が重複する可能性があります。

**悪い例**:
```hcl
# プロジェクトAとプロジェクトBで同じ名前になってしまう
tags = {
  Name = "server-Public-A-dev"  # どのプロジェクトか不明
}
```

**良い例**:
```hcl
# プロジェクトごとに一意の名前になる
tags = {
  Name = "${var.project_name}-server-Public-A-${var.environment}"
  # 結果: "example-project-server-Public-A-dev"
}
```

## 運用管理の効率化

### 1. AWS CLIでのフィルタリング
プロジェクト名を含めることで、特定プロジェクトのリソースのみを抽出できます：

```bash
aws ec2 describe-subnets --filters "Name=tag:Name,Values=example-project-*"
```

### 2. コスト配分タグ
プロジェクト名を含むタグを使用することで、AWS Cost Explorerでプロジェクト別のコスト分析が可能になります。

### 3. 自動化スクリプトでの利用
CI/CDパイプラインやメンテナンススクリプトで、プロジェクト固有のリソースを確実に特定できます。

## ベストプラクティス

### 1. 命名規則の統一
```hcl
# 推奨される命名パターン
"${var.project_name}-${リソースタイプ}-${詳細}-${環境}"
```

### 2. 変数を使用した柔軟性
ハードコードせずに変数を使用することで、プロジェクト名の変更に柔軟に対応できます：

```hcl
variable "project_name" {
  description = "プロジェクト名"
  type        = string
  default     = "example-project"
}
```

### 3. 環境変数の組み合わせ
開発・ステージング・本番環境でも一意性を保証：

```hcl
tags = {
  Name        = "${var.project_name}-${local.resource_type}-${var.environment}"
  Environment = var.environment
  Project     = var.project_name
}
```

## 関連
- [AWS Tagging Best Practices](https://docs.aws.amazon.com/general/latest/gr/aws_tagging.html)
- [Terraform AWS Provider - Resource Tags](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/guides/resource-tagging)
- [なぜタグのNameも環境別に区別すべきなのか](./2025.08.04.21.19_why_tags_name_should_distinct_by_environment.md)