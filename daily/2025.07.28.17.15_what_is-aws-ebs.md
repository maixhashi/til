# AWS EBS (Elastic Block Store) とは

## 概要

AWS EBS（Elastic Block Store）は、Amazon EC2インスタンスで使用するための永続的なブロックレベルストレージサービスです。従来のハードディスクドライブ（HDD）やソリッドステートドライブ（SSD）と同様に機能し、ファイルシステムの作成、データベースの実行、その他のブロックレベルストレージが必要なあらゆる用途に使用できます。

## 主な特徴

### 1. 永続性とデータ保護

- **データの永続性**
  - EC2インスタンスが停止・終了してもデータは保持される
  - インスタンスのライフサイクルから独立したストレージ

- **高い耐久性**
  - 年間故障率（AFR）0.1〜0.2%
  - アベイラビリティゾーン内で自動的にレプリケーション
  - コンポーネント障害から保護

### 2. 柔軟性とスケーラビリティ

- **動的なサイズ変更**
  - 稼働中のボリュームサイズを増やすことが可能
  - ダウンタイムなしでストレージ容量を拡張

- **スナップショット機能**
  - ポイントインタイムバックアップ
  - S3に保存され、高い耐久性を実現
  - 増分バックアップによる効率的なストレージ利用

### 3. パフォーマンスの最適化

- **複数のボリュームタイプ**
  - 用途に応じて最適なパフォーマンスと価格を選択
  - IOPS（Input/Output Per Second）の保証

## ボリュームタイプ

### 1. 汎用SSD（gp3、gp2）

#### gp3（最新世代）
- **ベースライン性能**: 3,000 IOPS、125 MB/秒
- **最大性能**: 16,000 IOPS、1,000 MB/秒
- **容量**: 1 GiB〜16 TiB
- **特徴**: IOPSとスループットを独立して設定可能
- **用途**: ブートボリューム、開発・テスト環境

#### gp2（前世代）
- **性能**: 3 IOPS/GiB（最小100、最大16,000 IOPS）
- **バースト**: 3,000 IOPSまでバースト可能
- **容量**: 1 GiB〜16 TiB

### 2. プロビジョンドIOPS SSD（io2、io1）

#### io2 Block Express
- **最大IOPS**: 256,000 IOPS
- **最大スループット**: 4,000 MB/秒
- **容量**: 4 GiB〜64 TiB
- **耐久性**: 99.999%
- **用途**: ミッションクリティカルなデータベース

#### io2
- **最大IOPS**: 64,000 IOPS
- **最大スループット**: 1,000 MB/秒
- **容量**: 4 GiB〜16 TiB

### 3. スループット最適化HDD（st1）

- **スループット**: 最大500 MB/秒
- **容量**: 125 GiB〜16 TiB
- **用途**: ビッグデータ、データウェアハウス、ログ処理
- **特徴**: シーケンシャルアクセスに最適化

### 4. コールドHDD（sc1）

- **スループット**: 最大250 MB/秒
- **容量**: 125 GiB〜16 TiB
- **用途**: アクセス頻度の低いデータ
- **特徴**: 最も低コストなEBSボリューム

## EBSの主要機能

### 1. スナップショット

- **作成方法**
  ```
  - ポイントインタイムコピー
  - 稼働中のボリュームからも作成可能
  - 増分バックアップ
  ```

- **活用方法**
  - バックアップとリストア
  - ボリュームの複製
  - リージョン間でのデータ移行
  - AMI（Amazon Machine Image）の作成

### 2. 暗号化

- **保存時の暗号化**
  - AWS Key Management Service（KMS）を使用
  - AES-256暗号化
  - ボリューム、スナップショット、AMIすべてを暗号化

- **暗号化の利点**
  - コンプライアンス要件への対応
  - データ漏洩リスクの軽減
  - 追加のパフォーマンスオーバーヘッドなし

### 3. マルチアタッチ（io2のみ）

- **機能概要**
  - 1つのボリュームを複数のEC2インスタンスに同時アタッチ
  - 同一アベイラビリティゾーン内のみ

- **用途**
  - 高可用性クラスターアプリケーション
  - 共有ストレージが必要なワークロード

## 料金体系

### 1. ボリューム料金

- **課金単位**: GB-月
- **価格例**（東京リージョン）:
  - gp3: $0.096/GB-月
  - io2: $0.142/GB-月 + $0.074/プロビジョンドIOPS
  - st1: $0.054/GB-月
  - sc1: $0.018/GB-月

### 2. スナップショット料金

- **保存料金**: $0.05/GB-月
- **データ転送料金**: リージョン間転送時に発生

### 3. 追加料金

- **高速スナップショットリストア**: 有効化したAZ毎に課金
- **EBS最適化インスタンス**: インスタンスタイプによって異なる

## ベストプラクティス

### 1. パフォーマンス最適化

- **適切なボリュームタイプの選択**
  - ワークロードの特性を理解
  - コストとパフォーマンスのバランス

- **EBS最適化インスタンスの使用**
  - 専用のネットワーク帯域幅
  - 安定したパフォーマンス

### 2. データ保護

- **定期的なスナップショット**
  - AWS Backup または Data Lifecycle Manager の活用
  - RPO（Recovery Point Objective）に基づいたスケジュール設定

- **暗号化の有効化**
  - 新規ボリュームは暗号化を推奨
  - 既存ボリュームは暗号化されたスナップショットから復元

### 3. コスト最適化

- **未使用ボリュームの削除**
  - 定期的な監査
  - CloudWatchメトリクスでの使用状況確認

- **適切なサイジング**
  - 過剰なプロビジョニングを避ける
  - 必要に応じて動的にサイズ変更

### 4. 監視とアラート

- **CloudWatchメトリクス**
  - VolumeReadBytes/VolumeWriteBytes
  - VolumeReadOps/VolumeWriteOps
  - VolumeThroughputPercentage
  - VolumeConsumedReadWriteOps

- **アラート設定**
  - IOPS使用率
  - バーストバランス（gp2）
  - スループット使用率

## EBS vs インスタンスストア

### EBS を選ぶ場合

- データの永続性が必要
- バックアップとリストアが必要
- 柔軟なストレージ管理が必要
- 高い可用性が要求される

### インスタンスストアを選ぶ場合

- 一時的なデータストレージ
- 最高のI/Oパフォーマンスが必要
- コストを最小化したい
- データの永続性が不要

## よくある使用例

### 1. データベース

- **リレーショナルデータベース**: io2 または gp3
- **NoSQLデータベース**: gp3 または st1
- **インメモリデータベース**: gp3（永続化用）

### 2. ファイルシステム

- **ブートボリューム**: gp3
- **アプリケーションデータ**: gp3 または io2
- **ログストレージ**: st1 または sc1

### 3. ビッグデータとアナリティクス

- **データレイク**: st1
- **ETL処理**: st1
- **長期アーカイブ**: sc1

## トラブルシューティング

### 1. パフォーマンス問題

- **原因と対策**
  - IOPS制限: より高いIOPSのボリュームタイプに変更
  - スループット制限: st1への変更を検討
  - ネットワーク帯域幅: EBS最適化インスタンスを使用

### 2. アタッチメントエラー

- **確認事項**
  - インスタンスとボリュームが同じAZにあるか
  - デバイス名の競合がないか
  - ボリュームのステータスが"available"か

### 3. スナップショット作成の遅延

- **対策**
  - 初回スナップショットは時間がかかることを理解
  - 増分スナップショットの活用
  - 必要に応じて高速スナップショットリストアを使用

## まとめ

AWS EBSは、EC2インスタンスに永続的で高性能なブロックストレージを提供する重要なサービスです。適切なボリュームタイプの選択、定期的なバックアップ、暗号化の実装により、安全で効率的なストレージソリューションを構築できます。コストとパフォーマンスのバランスを考慮しながら、ワークロードに最適な構成を選択することが重要です。

## 参考リンク

- [AWS EBS公式ドキュメント](https://docs.aws.amazon.com/ebs/)
- [EBS料金](https://aws.amazon.com/jp/ebs/pricing/)
- [EBSボリュームタイプ](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-volume-types.html)
- [EBSベストプラクティス](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-best-practices.html)