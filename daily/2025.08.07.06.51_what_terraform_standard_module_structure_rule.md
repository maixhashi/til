# TFLintのterraform_standard_module_structureルールとは

## What's this file?
> [!NOTE]
> **What**
> 
> terraform_standard_module_structureルールとは何かについて記載しています。

## Conclusion (忙しいとき向け)
> [!IMPORTANT]
> **What** : terraform_standard_module_structureルールとは何か
> 
> **Answer** : TFLintのルールで、Terraformモジュールが標準的なディレクトリ構造とファイル命名規則に従っているかをチェックする検証ルール

## 目次

<details>
<summary>目次を開く</summary>

- [ルールの概要](#ルールの概要)
- [標準モジュール構造とは](#標準モジュール構造とは)
- [チェック対象のファイル](#チェック対象のファイル)
- [ルールが要求する構造](#ルールが要求する構造)
- [違反例と準拠例](#違反例と準拠例)
- [設定オプション](#設定オプション)
- [無効化する場合の判断基準](#無効化する場合の判断基準)

</details>

## ルールの概要

`terraform_standard_module_structure`は、Terraformモジュールが推奨される標準的な構造に従っているかを検証するTFLintのルールです。

主な目的：
- モジュールの一貫性確保
- 保守性の向上
- チーム間での共通理解促進
- Terraform公式のベストプラクティス準拠

## 標準モジュール構造とは

Terraform公式が推奨するモジュールの標準的なディレクトリ構造とファイル配置のことです。

基本構造：
```
module/
├── README.md
├── main.tf
├── variables.tf
├── outputs.tf
├── versions.tf
├── examples/
│   └── example-1/
│       ├── main.tf
│       └── variables.tf
└── modules/
    └── submodule/
        ├── main.tf
        ├── variables.tf
        └── outputs.tf
```

## チェック対象のファイル

### 必須ファイル
- `main.tf` - メインのリソース定義
- `variables.tf` - 入力変数の定義
- `outputs.tf` - 出力値の定義

### 推奨ファイル
- `versions.tf` - Terraformとプロバイダーのバージョン制約
- `README.md` - モジュールのドキュメント
- `examples/` - 使用例のディレクトリ

### オプションファイル
- `providers.tf` - プロバイダー設定
- `locals.tf` - ローカル値の定義
- `data.tf` - データソースの定義

## ルールが要求する構造

### 1. ファイル分離の原則

各ファイルには特定の目的があり、混在させない：
- `main.tf`: リソースとモジュール呼び出しのみ
- `variables.tf`: variable ブロックのみ
- `outputs.tf`: output ブロックのみ
- `versions.tf`: terraform と required_providers ブロック

### 2. ネーミング規則

- ファイル名は小文字とハイフンのみ使用
- `.tf`拡張子を使用
- 特定の目的を持つファイルは標準名を使用

### 3. ディレクトリ構造

- サブモジュールは`modules/`ディレクトリ内に配置
- 使用例は`examples/`ディレクトリ内に配置
- テストは`tests/`または`test/`ディレクトリ内に配置

## 違反例と準拠例

### 違反例

```
# すべてを1つのファイルに記述
terraform.tf:
  - variables
  - outputs  
  - resources
  - providers
```

### 準拠例

```
# 適切に分離されたファイル
main.tf       # リソース定義
variables.tf  # 入力変数
outputs.tf    # 出力値
versions.tf   # バージョン制約
```

## 設定オプション

### 基本設定

```hcl
rule "terraform_standard_module_structure" {
  enabled = true
}
```

### 無効化

```hcl
rule "terraform_standard_module_structure" {
  enabled = false  # 独自構造を使用する場合
}
```

## 無効化する場合の判断基準

### 無効化が適切なケース

1. **既存プロジェクトの構造**
   - 既に確立された独自の構造がある
   - 大規模なリファクタリングが困難

2. **特殊な要件**
   - 企業固有のガイドライン
   - 複雑なモジュール構成

3. **段階的移行**
   - 標準構造への移行途中
   - 部分的な準拠から開始

### 無効化のデメリット

- Terraformコミュニティのベストプラクティスから逸脱
- 新規メンバーの学習コスト増加
- 外部モジュールとの一貫性欠如

## 関連

- [Terraform Module Structure](https://www.terraform.io/docs/modules/structure.html)
- [TFLint Rules Documentation](https://github.com/terraform-linters/tflint/blob/master/docs/rules/terraform_standard_module_structure.md)
- プロジェクトのTerraform設計ガイド
- モジュール開発のベストプラクティス