# Terraformにおけるnameパラメータとtagsのnameの違い

## What's this file?

> [!NOTE]
> **What**
> 
> Terraformのリソース定義におけるnameパラメータとtagsブロック内のNameタグとは何かについて記載しています。

## Conclusion (忙しいとき向け)

> [!IMPORTANT]
> **What** : nameパラメータとtagsのNameタグとは何か
> 
> **Answer** : nameはAWSリソースの実際の識別子として使用され、tagsのNameは表示用ラベルとして使用される。nameは必須パラメータの場合が多く、Nameタグは任意だが運用上重要

## 目次

<details>
<summary>目次を開く</summary>

- [1. nameパラメータとは](#1-nameパラメータとは)
- [2. tagsのNameタグとは](#2-tagsのnameタグとは)
- [3. 主な違いと使い分け](#3-主な違いと使い分け)
- [4. リソース別の実装例](#4-リソース別の実装例)
- [5. ベストプラクティス](#5-ベストプラクティス)

</details>

## 1. nameパラメータとは

### リソースの実際の識別子

nameパラメータは、AWSリソースの実際の識別子として機能します：

```hcl
# Security Groupの例
resource "aws_security_group" "example" {
  name        = "my-security-group"  # AWS内部で使用される実際の名前
  description = "Example security group"
  vpc_id      = aws_vpc.main.id
}

# ECS Clusterの例
resource "aws_ecs_cluster" "main" {
  name = "my-ecs-cluster"  # クラスターの実際の名前
}
```

### nameパラメータの特徴

1. **一意性要件**
   - 多くのリソースでリージョン内で一意である必要がある
   - 重複するとリソース作成エラーになる

2. **変更制限**
   - 多くのリソースでnameの変更は再作成を伴う
   - 稼働中のシステムでは影響が大きい

3. **API/CLIでの参照**
   - AWS CLI、SDK、API呼び出しで使用される
   - プログラム的なアクセスで重要

## 2. tagsのNameタグとは

### 表示用のラベル

tagsブロック内のNameタグは、主に表示用のラベルとして機能します：

```hcl
# Security Groupの例（nameとNameタグの両方を設定）
resource "aws_security_group" "example" {
  name        = "sg-prod-web-alb"  # システム的な名前
  description = "ALB security group for production web"
  vpc_id      = aws_vpc.main.id
  
  tags = {
    Name        = "Production Web ALB Security Group"  # 人間が読みやすい表示名
    Environment = "production"
    Purpose     = "ALB ingress rules"
  }
}
```

### Nameタグの特徴

1. **表示最適化**
   - AWSコンソールで優先的に表示される
   - スペースや日本語も使用可能

2. **変更の容易さ**
   - いつでも変更可能
   - リソースの再作成は不要

3. **任意設定**
   - 必須ではないが、運用上は強く推奨
   - コンソールでの識別性が大幅に向上

## 3. 主な違いと使い分け

### 機能的な違い

| 項目 | nameパラメータ | tagsのNameタグ |
|------|---------------|---------------|
| 用途 | リソースの実際の識別子 | 表示用ラベル |
| 必須性 | リソースによって必須 | 任意（推奨） |
| 一意性 | 多くの場合必要 | 不要 |
| 変更可能性 | 制限あり（再作成を伴う場合が多い） | いつでも変更可能 |
| 文字制限 | 厳格（英数字、ハイフンなど） | 柔軟（スペース、日本語OK） |
| API/CLI参照 | 使用される | 使用されない |
| コンソール表示 | リソースIDとして表示 | 優先的に表示される |

### 使い分けの指針

```hcl
# 推奨される命名パターン
resource "aws_instance" "web" {
  # nameパラメータ: システム的、プログラム的な識別子
  # - 英数字とハイフンのみ
  # - 環境や用途を含む
  # - 自動化ツールで参照しやすい形式
  instance_type = "t3.micro"
  
  tags = {
    # Nameタグ: 人間が理解しやすい表示名
    # - わかりやすい説明的な名前
    # - スペースや日本語も使用可能
    # - チームメンバーが見て理解できる形式
    Name        = "Web Server - Production Frontend"
    Environment = "production"
    ManagedBy   = "terraform"
  }
}
```

## 4. リソース別の実装例

### nameパラメータが必須のリソース

```hcl
# Security Group（name必須）
resource "aws_security_group" "db" {
  name        = "${var.project}-${var.env}-db-sg"
  description = "Database security group"
  vpc_id      = aws_vpc.main.id
  
  tags = {
    Name = "${var.project} Database Security Group (${var.env})"
  }
}

# S3 Bucket（bucket名必須、グローバルで一意）
resource "aws_s3_bucket" "static" {
  bucket = "${var.project}-static-${var.env}-${data.aws_caller_identity.current.account_id}"
  
  tags = {
    Name = "${var.project} Static Assets Bucket"
  }
}
```

### nameパラメータがないリソース

```hcl
# EC2 Instance（nameパラメータなし、Nameタグで識別）
resource "aws_instance" "app" {
  ami           = data.aws_ami.amazon_linux_2.id
  instance_type = "t3.micro"
  
  tags = {
    Name = "${var.project}-app-${var.env}"  # これが実質的な名前として機能
  }
}

# EBS Volume（nameパラメータなし）
resource "aws_ebs_volume" "data" {
  availability_zone = aws_instance.app.availability_zone
  size              = 100
  
  tags = {
    Name = "${var.project}-data-volume-${var.env}"
  }
}
```

### name_prefixを使用するパターン

```hcl
# Launch Template（name_prefixで自動的に一意な名前を生成）
resource "aws_launch_template" "app" {
  name_prefix = "${var.project}-lt-"  # 実際の名前: project-lt-20240101123456
  
  tags = {
    Name = "${var.project} App Launch Template"
  }
}

# IAM Role（name_prefixで衝突を回避）
resource "aws_iam_role" "ecs_task" {
  name_prefix = "${var.project}-ecs-task-"
  
  tags = {
    Name = "${var.project} ECS Task Role"
  }
}
```

## 5. ベストプラクティス

### 命名規則の統一

```hcl
# locals.tfで命名規則を定義
locals {
  # システム的な名前（nameパラメータ用）
  resource_prefix = "${var.project}-${var.environment}"
  
  # 表示用の名前（Nameタグ用）
  name_tag_prefix = "${var.project_name} (${title(var.environment)})"
  
  # 共通タグ
  common_tags = {
    Project     = var.project_name
    Environment = var.environment
    ManagedBy   = "terraform"
    CreatedAt   = timestamp()
  }
}

# リソースでの使用例
resource "aws_alb" "main" {
  name               = "${local.resource_prefix}-alb"  # shimz-prod-alb
  load_balancer_type = "application"
  subnets            = aws_subnet.public[*].id
  
  tags = merge(local.common_tags, {
    Name = "${local.name_tag_prefix} Application Load Balancer"  # Shimz Monitoring (Production) Application Load Balancer
    Type = "alb"
  })
}
```

### 自動化を考慮した設計

```hcl
# データソースでの検索を考慮
data "aws_security_group" "existing" {
  # nameパラメータで検索（確実）
  name = "${var.project}-${var.environment}-web-sg"
}

# またはタグで検索（柔軟）
data "aws_security_groups" "by_tag" {
  tags = {
    Environment = var.environment
    Purpose     = "web-server"
  }
}
```

### トラブルシューティングのための設計

```hcl
resource "aws_ecs_service" "app" {
  name            = "${local.resource_prefix}-app-service"
  cluster         = aws_ecs_cluster.main.id
  task_definition = aws_ecs_task_definition.app.arn
  
  tags = merge(local.common_tags, {
    Name         = "${local.name_tag_prefix} App Service"
    LogGroup     = "/ecs/${local.resource_prefix}-app"  # ログとの関連付け
    AlertContact = var.alert_email                      # 運用情報の付加
  })
}
```

## 関連

- [AWS Tagging Best Practices](https://docs.aws.amazon.com/general/latest/gr/aws_tagging.html)
- [Terraform AWS Provider - Resource Naming](https://registry.terraform.io/providers/hashicorp/aws/latest/docs)
- [なぜTerraformで環境別にリソース名を区別する必要があるのか](./2025.08.04.20.57_why_terraform_resource_naming_by_environment.md)